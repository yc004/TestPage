<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <link rel="stylesheet" href="main.css">
</head>
<body>
<canvas id="mainCanvas" width="600" height="400">
    当前浏览器不支持,请更新
</canvas>
</body>
<script>
    let mainCanvas = document.getElementById('mainCanvas');
    let context = mainCanvas.getContext('2d');

    // 用于设置canvas画布大小永远充满窗口
    $(function () {
        $(window).resize(resizeCanvas);
        resizeCanvas();
    })

    function resizeCanvas() {
        $('#mainCanvas').attr('width', $(window).get(0).innerWidth)
            .attr('height', $(window).get(0).innerHeight);
    }

    colors = ['#17B2C9',
        '#FF0000',
        '#00FF00',
        '#0000FF',
        '#FFFF00',
        '#FF00FF',
        '#00FFFF',
        '#808080',
        '#FFA500',
        '#8B008B'
    ]


    // 烟花类
    class fireWorks {
        // 烟花主体粒子列表
        fireWorkList = [];
        // 烟花爆炸后粒子列表
        explodeParticles = [];

        constructor(initialCount) {
            for (let i = 0; i < initialCount; i++) {
                this.fireWorkList[i] = new Particles(Math.random() * window.innerWidth,
                    window.innerHeight - Math.random() * 30, 0,
                    Math.random() * 3 + 1,
                    colors[Math.floor(Math.random() * colors.length)]);
            }
        }

        // 刷新烟花位置
        update() {
            for (let i = 0; i < this.fireWorkList.length; i++) {
                this.fireWorkList[i].run();
                // 判断烟花主体是否到达指定的爆炸高度
                if (this.fireWorkList[i].vy <= 0.01) {
                    this.explode(this.fireWorkList[i]);
                    this.fireWorkList.splice(i, 1);
                }
            }

            // 爆炸粒子移动
            for (let i = 0; i < this.explodeParticles.length; i++) {
                this.explodeParticles[i].run();
                if (this.explodeParticles[i].x >= mainCanvas.width || this.explodeParticles[i].x <= 0
                    || this.explodeParticles[i].y >= mainCanvas.height || this.explodeParticles[i].y <= 0) {
                    this.explodeParticles.splice(i, 1);
                }
            }

            // 随机生成新的烟花
            if (Math.random() < 0.03) {
                this.fireWorkList.push(new Particles(Math.random() * window.innerWidth,
                    window.innerHeight - Math.random() * 30, 0,
                    Math.random() * 3 + 1,
                    colors[Math.floor(Math.random() * colors.length)]))
            }
        }


        explode(particle) {
            let speed = 4;
            let explodeCount = 200;
            // for (let j = explodeCount && speed > 0; j > 0; j -= 10) {
                for (let i = 0; i < j; i++) {
                    this.explodeParticles.push(new Particles(particle.x, particle.y, speed * Math.cos(Math.PI * 2 / j * i), speed * Math.sin(Math.PI * 2 / j * i), particle.color));
                    // console.log("*");
                }
                // speed -= 0.001;
            // }
        }

        render() {
            for (let i = 0; i < this.fireWorkList.length; i++) {
                // 渲染烟花主体
                context.fillStyle = this.fireWorkList[i].color;
                context.beginPath();
                context.arc(this.fireWorkList[i].x, this.fireWorkList[i].y, 3, 0, Math.PI * 2);
                context.fill();
                context.closePath();
            }

            // 渲染爆炸后的粒子
            for (let i = 0; i < this.explodeParticles.length; i++) {
                context.fillStyle = this.explodeParticles[i].color;
                context.beginPath();
                context.arc(this.explodeParticles[i].x, this.explodeParticles[i].y, 1, 0, Math.PI * 2);
                context.fill();
                context.closePath();

            }
        }
    }

    class Particles {
        constructor(x, y, vx, vy, color, radium = 0) {
            this.x = x;
            this.y = y;
            this.vx = vx;
            this.vy = vy;
            this.color = color;
        }

        run() {
            this.x -= this.vx;
            this.y -= this.vy;
            // if (this.vx !== 0) {
            //     this.vx = this.vx > 0 ? this.vx - 0.01 : this.vx + 0.01;
            // }
            this.vy -= 0.015;
        }

    }


    Fireworks = new fireWorks(10);

    // 主循环
    function main() {
        context.clearRect(0, 0, mainCanvas.width, mainCanvas.height);
        Fireworks.update();
        Fireworks.render();
        requestAnimationFrame(main);
    }

    main()


</script>
</html>